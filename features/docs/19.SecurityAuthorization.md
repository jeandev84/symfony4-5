### Security Authorization


1. Install expression-language package
```
$ composer require symfony/expression-language
```


2. Authorization using annotations 
```

...

    /**
     * @Route("/admin/videos/delete-by-owner/{id}", name="admin.video.delete.by-owner", methods={"DELETE"})
     * @Security("securityUser.getId() == video.getSecurityUser().getId()")
    */
    public function deleteUserVideo(Video $video)
    {
          [ Executed only if current authenticated user == user current video to delete ]   
          [ If current authenticated user is owner video to delete, then this code will be executed ]
          dd($video);
    }
    
    
    
    /**
     * @Route("/admin/videos/delete-by-admin/{id}", name="admin.video.delete.by.admin")
     * @Security("has_role('ROLE_ADMIN')")
    */
    public function deleteVideoOnlyByAdmin(Video $video)
    {
        dd($video);
    }
...
```


3. Authorization using config file (./config/packages/security.yaml)
```
security:
    encoders:
        App\Entity\SecurityUser:
            algorithm: auto

    # https://symfony.com/doc/current/security.html#where-do-users-come-from-user-providers
    providers:
        # used to reload user from session & other features (e.g. switch_user)
        app_user_provider:
            entity:
                class: App\Entity\SecurityUser
                property: email
    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false
        main:
            anonymous: lazy
            provider: app_user_provider

            # activate different ways to authenticate
            # https://symfony.com/doc/current/security.html#firewalls-authentication
            # https://symfony.com/doc/4.4/security.html#3a-authentication-firewalls
            # https://symfony.com/doc/4.4/security/form_login.html
            # https://symfony.com/doc/4.4/security/form_login_setup.html
            form_login:
                login_path: auth.user.login
                check_path: /auth/user/login
                # html input fields name required
                username_parameter: 'email'
                password_parameter: 'password'
                # https://symfony.com/doc/4.4/security/form_login.html#csrf-protection-in-login-forms
                csrf_token_generator: security.csrf.token_manager


            # Logout section [target: redirect to "home" page after logout]
            logout:
                path: /logout
                target: home

            # Remember me cookie
            # if [path: /home] remember_me will be applied only in "/home"
            remember_me:
                secret: '%kernel.secret%'
                lifetime: 604800 # 1 week in seconds
                # always_remember_me: true
                path: /

            # https://symfony.com/doc/current/security/impersonating_user.html
            # switch_user: true

    # Easy way to control access for large sections of your site
    # Note: Only the *first* access control that matches will be used
    access_control:
         - { path: ^/admin, roles: ROLE_ADMIN }
#         - { path: ^/profile, roles: ROLE_USER }


```



4. Authorization using denyAccessUnlessGranted()
```


public function unlessAccessAuthenticatedFully()
{
      $this->denyAccessUnlessGranted('IS_AUTHENTICATED_FULLY');

      // User cannot access in this page if is not authenticated fully
}


public function unlessAccessUserByAdmin()
{
    $this->denyAccessUnlessGranted('ROLE_ADMIN');

    // User cannot access in this page if is not admin user
}




public function unlessAccessAuthenticatedRemembered()
{
    $this->denyAccessUnlessGranted('IS_AUTHENTICATED_REMEMBERED');

    // User cannot access in front page if he does no checked remember me
}

```


5. Authorization using view files
```
{% extends 'base.html.twig' %}

{% block title %}Hello{% endblock %}

{% block body %}
<div class="container mt-5">
    <nav>
        <ul>
            {% if app.user %}
                <li><a href="{{ path('logout') }}">Logout</a></li>
                {% if is_granted('ROLE_ADMIN') %}
                    <li><a href="#">Delete something, only admin can do this</a></li>
                {% endif %}
                {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                    <li>Username: {{ app.user.username }}</li>
                {% endif %}
            {% else %}
                <li><a href="{{ path('auth.user.login') }}">Login</a></li>
                <li><a href="{{ path('auth.user.register') }}">Registration</a></li>
            {% endif %}
        </ul>
    </nav>
    <div class="content">
        <h1>Welcome to symfony features</h1>
    </div>
</div>
{% endblock %}

```


6. Authorization using VOTERS
```
$ bin/console make:voter

The name of the security voter class (e.g. BlogPostVoter):
 > VideoVoter

 created: src/Security/Voter/VideoVoter.php

           
  Success! 
           

 Next: Open your voter and add your logic.
 Find the documentation at https://symfony.com/doc/current/security/voters.html

```